{
  "hash": "212bd63323d668cbf0be3cd53632a4d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Gaussian Copulas for Large Spatial Fields\"\nsubtitle: \"Modeling Data-Level Spatial Dependence in Multivariate Generalized Extreme Value Distributions\"\nauthor: \"Brynjólfur Gauti Guðrúnar Jónsson\"\ninstitute: \"University of Iceland\"\nformat: \n  revealjs:\n    theme: theme.scss\n    auto-stretch: true\n    simplemenu:\n      flat: false\n      barhtml:\n        header: \"<div class='menubar mb-10'><ul class='menu'></ul><div>\"\n        footer: \"<div class='footer footer-default' style='display: block;'> <a href='https://bggj.is/stancon24' target='_blank'>bggj.is/stancon24</a>  <img src='hi-audkenni_28-raunsvisd.png' class='slide-logo r-stretch'></div>\"\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nrevealjs-plugins:\n  - simplemenu\nbibliography: references.bib\ncsl: cambridge-university-press-numeric.csl\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n## Example {data-name=\"Copulas\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nQ <- make_AR_prec_matrix(dim = 60, rho = 0.9)\nZ <- rmvn.sparse(n = 1, mu = rep(0, nrow(Q)), CH = Cholesky(Q)) |> \n  as.numeric()\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\n\n\n## Example \n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n\n\n## Example \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nU <- pnorm(Z)\nY <- qgev(U, loc = 10, scale = 5, shape = 0.1)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n\n\n## Example \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\n\n## Example \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nQ <- make_AR_prec_matrix(dim = 60, rho = -0.8)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n\n\n## What's going on? {style=\"font-size:60%\"}\n\n\n* $y_t$ is marginally $\\mathrm{GEV}(\\mu, \\sigma, \\xi)$\n\n::: {style=\"font-size:80%\"}\n$$\n\\log f(y_t \\vert \\mu, \\sigma, \\xi) = - n\\log\\sigma - (1 + \\frac{1}{\\xi}) \\sum_{i=1}^{n}{\\log\\left(1 + \\xi\\left[\\frac{z_i - \\mu}{\\sigma} \\right]\\right)} - \\sum_{i=1}^{n}{\\left(1 + \\xi \\left[ \\frac{z_i - \\mu}{\\sigma} \\right]\\right)}^{-1/\\xi}\n$$\n:::\n\n* $\\mathbf Y$ has a Gaussian AR(1) copula\n\n$$\n\\begin{aligned}\n\\log c(\\mathbf{u}) &\\propto \\frac{1}{2}\\log|\\mathbf{Q}| - \\frac{1}{2}\\mathbf{z}^T\\mathbf{Q}\\mathbf{z} + \\frac{1}{2}\\mathbf{z}^T\\mathbf{z} \\\\\nu_t &= F_{\\mathrm{GEV}}(y_t \\vert \\mu, \\sigma, \\xi) \\\\\nz_t &= \\Phi^{-1}(u_t)\n\\end{aligned}\n$$\n\n* How to estimate all of this?\n\n## Copulas\n\n::: {style=\"font-size:65%; margin-top:20px;\"}\n\n**Sklar's Theorem**: For any multivariate distribution $H$, there exists a unique copula $C$ such that:\n\n$$\nH(\\mathbf x) = C(F_1(x_1), \\dots, F_d(x_d))\n$$\n\nwhere $F_i$ are marginal distributions. \n\n----------\n\n\nWe can also write this as a (log) density\n\n$$\n\\begin{aligned}\nh(x) &= c(F_1(x_1), \\dots, F_d(x_d)) \\prod_{i=1}^d f_i(x_i) \\\\\n\\log h(\\mathbf x) &= \\log c\\left(F_1(x_1), \\dots, F_d(x_d)\\right) + \\sum_{i=1}^d \\log f_i(x_i)\n\\end{aligned}\n$$\n\n:::\n\n## Have no fear\n\n![](images/predator.jpg){fig-align=\"center\"}\n\n## Stan Model {style=\"font-size:60%\"}\n\n::: {.columns}\n::: {.column width=50%}\n\n\n\n::: {.cell output.var='ar1_gev1'}\n\n```{.stan .cell-code}\ndata {\n  int n_obs;\n  vector[n_obs] y;\n}\n\ntransformed data {\n  real min_y = min(y);\n}\n\nparameters {\n  real<lower = -1, upper = 1> rho;\n  real<lower = 0> sigma;\n  real<lower = 0> xi;\n  real<lower = 0, upper = min_y + sigma / xi> mu;\n}\n\nmodel {\n  vector[n_obs] U;\n  target += gev_lpdf(y | mu, sigma, xi);\n  for (i in 1:n_obs) {\n    U[i] = gev_cdf(y[i] | mu, sigma, xi);\n  }\n  target += normal_copula_ar1_lpdf(U | rho);\n\n  // Priors\n  target += std_normal_lpdf(rho);\n  target += exponential_lpdf(sigma | 1);\n  target += exponential_lpdf(xi | 1);\n}\n```\n:::\n\n\n\n:::\n::: {.column width=50%}\n\n\n\n\n::: {.cell output.var='ar1_'}\n\n```{.stan .cell-code}\nreal normal_ar1_lpdf(vector x, real rho) {\n  int N = num_elements(x);\n  real out;\n  real log_det = - (N - 1) * (log(1 + rho) + log(1 - rho)) / 2;\n  vector[N] q;\n  real scl = sqrt(1 / (1 - rho^2));\n  \n  q[1:(N - 1)] = scl * (x[1:(N - 1)] - rho * x[2:N]);\n  q[N] = x[N];\n  \n  out = log_det - dot_self(q) / 2;\n  \n  return out;\n}\n\nreal normal_copula_ar1_lpdf(vector U, real rho) {\n  int N = rows(U);\n  vector[N] Z = inv_Phi(U);\n  return normal_ar1_lpdf(Z | rho) + dot_self(Z) / 2;\n}\n```\n:::\n\n\n\n\n![](images/stanfit1.png)\n:::\n::: \n## Introduction {data-name=\"Background\"}\n\n::: {.columns style=\"font-size:70%\"}\n::: {.column width=\"70%\"}\n-   UKCP Local Projections on a 5km grid over the UK (1980-2080) [@metoffi]\n-   Challenge: Modeling maximum daily precipitation in yearly blocks\n    -   43,920 spatial locations on a 180 x 244 grid\n    -   Four parameters per location as in [@johannesson2021]\n        -   Location, Trend, Scale, Shape\n-   Two aspects of spatial dependence:\n    1.  GEV parameters (ICAR models)\n    2.  Data-level dependence (Copulas)\n:::\n\n::: {.column width=\"30%\"}\n![](images/ukcp_data.png){width=\"100%\"}\n:::\n:::\n\n## Calculating Multivariate Normal Densities\n\n::: {.columns style=\"font-size:60%\"}\n$$\n\\log f(\\mathbf{x}) \\propto \\frac{1}{2}\\left(\\log |\\mathbf{Q}| - \\mathbf{x}^T\\mathbf{Q}\\mathbf{x}\\right)\n$$\n\n::: {.column width=\"50%\"}\n### Computational challenges\n\n1.  **Log Determinant**: $\\log |\\mathbf{Q}|$\n    -   Constant for a given precision matrix\n2.  **Quadratic Form**: $\\mathbf{x}^T\\mathbf{Q}\\mathbf{x}$\n    -   Needs calculation for each density evaluation\n:::\n\n::: {.column width=\"50%\"}\n### Spatial Model Considerations\n\n-   Some models (e.g., ICAR) avoid log determinant calculation\n-   Efficient computation crucial for large-scale applications\n-   Fast algorithms when $\\mathbf{Q}$ is sparse [@rue2001; @rue2005]\n:::\n:::\n\n## Spatial Models\n\n::: {style=\"font-size:50%\"}\n#### Conditional Autoregression (CAR) [@besag1974]\n\n::: columns\n::: {.column width=\"50%\"}\n-   $\\mathbf{D}$ is a diagonal matrix with $D_{ii} = n_i$, the number of neighbours of $i$\n-   $\\mathbf{A}$ is the adjacency matrix with $A_{ij} = A_{ji} = 1$ if $i \\sim j$\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\mathbf{x} &\\sim N(\\mathbf{0}, \\tau \\mathbf{Q}) \\\\\n\\mathbf{Q} &= \\mathbf{D}\\left(\\mathbf{I} - \\alpha \\mathbf{A} \\right)\n\\end{aligned}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n#### Intrinsic Conditional Autoregression (ICAR) [@besag1991]\n\n::: columns\n::: {.column width=\"50%\"}\n-   $\\alpha = 1$, so $\\mathbf Q$ is singular, but constant\n-   Don't have to calculate $\\log |\\mathbf{Q}|$\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\mathbf{x} &\\sim N(\\mathbf{0}, \\tau \\mathbf{Q}) \\\\\n\\mathbf{Q} &= \\mathbf{D} - \\mathbf{A}\n\\end{aligned}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n::: columns\n::: {.column width=\"50%\"}\n#### BYM (Besag-York-Mollié) Model [@besag1991]\n\n-   $\\mathbf{u}$ is the structured spatial component (Besag model)\n-   $\\mathbf{v}$ is the unstructured component (i.i.d. normal)\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\mathbf{x} &= \\mathbf{u} + \\mathbf{v} \\\\\n\\mathbf{u} &\\sim \\mathrm{ICAR}(\\tau_u) \\\\\n\\mathbf{v} &\\sim N(\\mathbf{0}, \\tau_v^{-1})\n\\end{aligned}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n::: columns\n::: {.column width=\"50%\"}\n#### BYM2 Model [@riebler2016; @simpson2015]\n\n-   $\\rho$ models how much of variance is spatial\n-   $s$ is a scaling factor chosen to make $\\mathrm{Var}(\\mathbf u_i) \\approx 1$\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\mathbf{x} &= \\left(\\left(\\sqrt{\\rho/s}\\right)\\mathbf{u} + \\left(\\sqrt{1 - \\rho}\\right) \\mathbf{v} \\right)\\sigma \\\\\n\\mathbf{u} &\\sim \\mathrm{ICAR}(1) \\\\\n\\mathbf{v} &\\sim N(\\mathbf{0}, n)\n\\end{aligned}\n$$\n:::\n:::\n:::\n\n## Spatial Modeling on Parameter-level [@morris2019]\n\n::: {.columns style=\"font-size:50%\"}\n::: {.column width=\"45%\"}\n-   $\\mu$: location parameter\n    -   $\\mu = \\mu_0 \\left(1 + \\Delta \\left(t - t_0\\right)\\right)$\n-   $\\sigma$: scale parameter\n-   $\\xi$: shape parameter \n$$\n\\begin{aligned}\n\\log(\\mu_0) = \\psi &\\sim \\mathrm{BYM2}(\\mu_\\psi, \\rho_\\psi, \\sigma_\\psi) \\\\\n\\log(\\mu_0) - \\log(\\sigma) = \\tau &\\sim \\mathrm{BYM2}(\\mu_\\tau, \\rho_\\tau, \\sigma_\\tau) \\\\\nf_\\xi(\\xi) = \\phi &\\sim \\mathrm{BYM2}(\\mu_\\phi, \\rho_\\phi, \\sigma_\\phi) \\\\\nf_\\Delta(\\Delta) = \\gamma &\\sim \\mathrm{BYM2}(\\mu_\\gamma, \\rho_\\gamma, \\sigma_\\gamma)\n\\end{aligned}\n$$ \n![](images/bym_table.png)\n:::\n\n::: {.column width=\"55%\"}\n![](images/facet_constrained.png)\n:::\n:::\n\n## From Parameter-level to Data-level Dependence\n\n::: {.columns style=\"font-size:60%\"}\n::: {.column width=\"50%\"}\n### Parameter-level Dependence\n\n-   Assumes conditional independence\n-   Biased joint probability estimates\n-   Underestimates parameter variance\n:::\n\n::: {.column width=\"50%\"}\n### Copula\n\n-   Improves joint probabilities\n-   Enhances spatial risk assessment\n-   Better variance estimates\n:::\n:::\n\n::: {style=\"font-size:65%; margin-top:20px;\"}\n**Sklar's Theorem**: For any multivariate distribution $H$, there exists a unique copula $C$ such that:\n\n$$\nH(\\mathbf x) = C(F_1(x_1), \\dots, F_d(x_d))\n$$\n\nwhere $F_i$ are marginal distributions. We can also write this as a density\n\n$$\nh(x) = c(F_1(x_1), \\dots, F_d(x_d)) \\prod_{i=1}^d f_i(x_i)\n$$\n\n:::\n\n## Our Approach: Matérn-like Gaussian Copula\n\n::: {style=\"font-size:55%\"}\n\n$$\n\\begin{gathered}\n\\log h(\\mathbf x) = \\log c\\left(F_1(x_1), \\dots, F_d(x_d)\\right) + \\sum_{i=1}^d \\log f_i(x_i)\n\\end{gathered}\n$$\n\n------------------------------------------------------------------------\n\n::: columns\n### Marginal CDFs\n\n::: {.column width=\"50%\"}\n-   $F_i(x_i)$ is $\\mathrm{GEV}(\\mu_i, \\sigma_i, \\xi_i)$\n-   Can model parameter dependence with BYM2\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\log h(\\mathbf x) &= \\log c(u_1, \\dots, u_d) \\\\\n&+ \\sum_{i=1}^d \\log f_{\\mathrm{GEV}}(x_i \\vert \\mu_i, \\sigma_i, \\xi_i) \\\\\nu_i &= F_{\\mathrm{GEV}}(x_i \\vert \\mu_i, \\sigma_i, \\xi_i)\n\\end{aligned}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n::: columns\n### Gaussian Copula\n\n::: {.column width=\"50%\"}\n-   Matérn-like precision matrix $\\mathbf{Q}$ [@lindgren2011]\n-   If $\\mathbf{Q} = \\mathbf{I}$ simplifies to independent margins\n-   Scaled so $\\boldsymbol{\\Sigma} = \\mathbf{Q}^{-1}$ is correlation matrix\n-   Need to calculate marginal variances [@rue2005a; @rue2007; @rue2009]\n-   How to generate, scale and compute with $\\mathbf{Q}$ quickly (for MCMC)?\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\begin{aligned}\n\\log c(\\mathbf u) &\\propto \\frac{1}{2}\\left(\\log |\\mathbf{Q}| - \\mathbf{z}^T\\mathbf{Q}\\mathbf{z} + \\mathbf{z}^T\\mathbf{z}\\right) \\\\\n\\mathbf{z} &= \\Phi^{-1}(\\mathbf u)\n\\end{aligned}\n$$\n:::\n:::\n:::\n\n## The Precision Matrix {data-name=\"Methods\"}\n\n::: {style=\"font-size:60%\"}\n$\\mathbf Q$ defined as Kronecker sum of two AR(1) precision matrices, similar to [@lindgren2011]\n\n$$\n\\mathbf{Q} = \\left( \\mathbf{Q}_{\\rho_1} \\otimes \\mathbf{I_{n_2}} + \\mathbf{I_{n_1}} \\otimes \\mathbf{Q}_{\\rho_2} \\right)^{\\nu + 1}, \\quad \\nu \\in \\{0, 1, 2\\}\n$$\n\n::: {.columns style=\"font-size:80%\"}\n::: {.column width=\"50%\"}\n$$\n\\mathbf{Q}_{\\rho_{1}} = \\frac{1}{1-\\rho_{1}^2}\n\\begin{bmatrix}\n1 & -\\rho_{1} & 0 & \\cdots & 0 \\\\\n-\\rho_{1} & 1+\\rho_{1}^2 & -\\rho_{1} & \\cdots & 0 \\\\\n0 & -\\rho_{1} & 1+\\rho_{1}^2 & \\cdots & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\ddots & \\vdots \\\\\n0 & 0 & 0 & \\cdots & 1\n\\end{bmatrix}\n$$\n:::\n\n::: {.column width=\"50%\"}\n$$\n\\mathbf{Q}_{\\rho_{2}} = \\frac{1}{1-\\rho_{2}^2}\n\\begin{bmatrix}\n1 & -\\rho_{2} & 0 & \\cdots & 0 \\\\\n-\\rho_{2} & 1+\\rho_{2}^2 & -\\rho_{2} & \\cdots & 0 \\\\\n0 & -\\rho_{2} & 1+\\rho_{2}^2 & \\cdots & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\ddots & \\vdots \\\\\n0 & 0 & 0 & \\cdots & 1\n\\end{bmatrix}\n$$\n:::\n\n$$\n\\mathbf Q = \\begin{bmatrix}\n\\frac{1}{(1-\\rho_1^2)}\\mathbf{I_{n_2}} + \\mathbf{Q_{\\rho_2}} & \\frac{-\\rho_1}{(1-\\rho_1^2)}\\mathbf{I_{n_2}} & \\dots & \\cdots & \\dots \\\\\n\\frac{-\\rho_1}{(1-\\rho_1^2)}\\mathbf{I_{n_2}} & \\frac{(1+\\rho_1^2)}{(1-\\rho_1^2)}\\mathbf{I_{n_2}} + \\mathbf{Q_{\\rho_2}} & \\frac{-\\rho_1}{(1-\\rho_1^2)} \\mathbf{I_{n_2}} & \\cdots & \\vdots  \\\\\n\\vdots & \\ddots & \\ddots & \\ddots & \\vdots \\\\\n\\dots & \\dots & \\cdots & \\frac{-\\rho_1}{(1-\\rho_1^2)} \\mathbf{I_{n_2}} & \\frac{1}{(1-\\rho_1^2)}\\mathbf{I_{n_2}} + \\mathbf{Q_{\\rho_2}}\n\\end{bmatrix}^{\\nu + 1}\n$$\n:::\n:::\n\n## Eigendecomposition\n\n::: {.columns style=\"font-size:65%\"}\nBecause of how $\\mathbf{Q}$ is defined [@horn1991], we know that\n\n$$\n\\begin{aligned}\n\\mathbf{Q} &= \\mathbf{V}\\boldsymbol{\\Lambda}\\mathbf{V} \\\\\n&= (\\mathbf{V_{\\rho_1}} \\otimes \\mathbf{V_{\\rho_2}})(\\boldsymbol \\Lambda_{\\rho_1} \\otimes \\mathbf{I} + \\mathbf{I} \\otimes \\boldsymbol \\Lambda_{\\rho_2})^{\\nu + 1}(\\mathbf{V_{\\rho_1}} \\otimes \\mathbf{V_{\\rho_2}})^T\n\\end{aligned}\n$$\n\nwhere\n\n$$\n\\begin{aligned}\n\\mathbf{Q}_{\\rho_1} = \\mathbf{V_{\\rho_1}}\\boldsymbol \\Lambda_{\\rho_1}\\mathbf{V_{\\rho_1}}^T \\qquad \\& \\qquad\n\\mathbf{Q}_{\\rho_2} = \\mathbf{V_{\\rho_2}}\\boldsymbol \\Lambda_{\\rho_2}\\mathbf{V_{\\rho_2}}^T\n\\end{aligned}\n$$\n\nSpectral decomposition defined by value/vector pairs of smaller matrices\n\n::: {.column width=\"50%\"}\n$$\n\\left\\{\\lambda_{\\rho_1}\\right\\}_i + \\left\\{\\lambda_{\\rho_2}\\right\\}_j\n$$\n:::\n\n::: {.column widht=\"50%\"}\n$$\n\\left\\{\\mathbf{v}_{\\rho_1}\\right\\}_i \\otimes \\left\\{\\mathbf{v}_{\\rho_2}\\right\\}_j\n$$\n:::\n\n-   Problem: $\\boldsymbol \\Sigma_{ii} = \\left(\\mathbf Q^{-1} \\right)_{ii} \\neq  1$\n-   Solution: $\\mathbf{\\widetilde  Q} = \\mathbf{D}\\mathbf{Q}\\mathbf{D}$, where $\\mathbf D_{ii} = \\sqrt{\\boldsymbol \\Sigma_{ii}}$\n:::\n\n## Marginal Standard Deviations\n\n::: {style=\"font-size:70%\"}\n$$\n\\boldsymbol \\Sigma = \\mathbf Q^{-1} = (\\mathbf{V}\\boldsymbol\\Lambda\\mathbf{V}^T)^{-1} = \\mathbf{V}\\boldsymbol \\Lambda^{-1}\\mathbf{V}\n$$\n\nWe know that if $A = BC$ then $A_{ii} = B_{i, .} C_{., i}$, so\n\n$$\n\\boldsymbol \\Sigma_{ii} = \\sum_{k=1}^{n} v_{ik} \\frac{1}{\\lambda_k} (v^T)_{ki} = \\sum_{k=1}^{n} v_{ik} \\frac{1}{\\lambda_k} v_{ik} = \\sum_{k=1}^{n} v_{ik}^2 \\frac{1}{\\lambda_k}\n$$\n\nCompute vector $\\boldsymbol \\sigma^2$ containing all marginal variances\n\n$$ \n\\boldsymbol \\sigma^2 = \\sum_{i = 1}^{n_1} \\sum_{j=1}^{n_2} \\frac{\\left(\\left\\{\\mathbf{v}_{\\rho_1}\\right\\}_i \\otimes \\left\\{\\mathbf{v}_{\\rho_2}\\right\\}_j\\right)^{2}}{\\quad\\left(\\left\\{\\lambda_{\\rho_1}\\right\\}_i + \\left\\{\\lambda_{\\rho_2}\\right\\}_j\\right)^{\\nu+1}}\n$$\n:::\n\n## Marginal Standard Deviations\n\n::: {.columns style=\"font-size:75%\"}\n::: {.column width=\"58%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim1 <- 50; dim2 <- 50\nrho1 <- 0.5; rho2 <- 0.3\nnu <- 2\n\nQ1 <- make_AR_prec_matrix(dim1, rho1)\nQ2 <- make_AR_prec_matrix(dim2, rho2)\n\nI1 <- Matrix::Diagonal(dim1)\nI2 <- Matrix::Diagonal(dim2)\n\nQ <- temp <- kronecker(Q1, I2) + kronecker(I1, Q2)\nfor (i in seq_len(nu)) Q <- Q %*% temp\n```\n:::\n\n\n\n:::\n\n::: {.column width=\"42%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmsd <- function(Q1, Q2) {\n\n  E1 <- eigen(Q1)\n  E2 <- eigen(Q2)\n\n  marginal_sd_eigen(\n    E1$values, E1$vectors, dim1,\n    E2$values, E2$vectors, dim2,\n    nu\n  ) |> \n  sort()\n}\n```\n:::\n\n\n\n:::\n:::\n\n::: {style=\"font-size:75%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbench::mark(\n  \"solve\" = solve(Q) |> diag() |> sqrt() |> sort(),\n  \"inla.qinv\" = inla.qinv(Q) |> diag() |> sqrt() |> sort(),\n  \"marginal_sd_eigen\" = msd(Q1, Q2),\n  iterations = 10,\n  filter_gc = FALSE \n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  expression             min   median `itr/sec` mem_alloc `gc/sec`\n  <bch:expr>        <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>\n1 solve                1.16s    1.17s     0.838   78.15MB    0.670\n2 inla.qinv         377.65ms 382.19ms     2.52     4.35MB    0.252\n3 marginal_sd_eigen   1.35ms   1.46ms   597.     647.36KB    0    \n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Calculating the (non-copula) density\n\n::: {style=\"font-size:70%\"}\nThe Gaussian log pdf is $$\n\\log f(\\mathbf{u} \\vert \\mathbf{Q}) \\propto \\frac{1}{2}\\left(\\log|\\mathbf{Q}| - \\mathbf{z}^T\\mathbf{Q}\\mathbf{z}\\right)\n$$\n\nWithout scaling of $\\mathbf Q$ we get\n\n$$\n\\log|\\mathbf{Q}| = \\sum_{k=1}^{n_1n_2}\\log\\lambda_k = \\sum_{i=1}^{n_1}\\sum_{j=2}^{n_2} \\log\\left[\\left(\\left\\{\\lambda_{\\rho_1}\\right\\}_i + \\left\\{\\lambda_{\\rho_2}\\right\\}_j\\right)^{\\nu + 1}\\right]\n$$\n\n$$\n\\mathbf{z}^T\\mathbf{Q}\\mathbf{z} = \\sum_{k=1}^{n_1n_2}\\lambda_k \\left(v_k^T\\mathbf z\\right)^2 = \n\\sum_{i=1}^{n_1}\\sum_{j=2}^{n_2} \n\\left(\\left\\{\\lambda_{\\rho_1}\\right\\}_i + \\left\\{\\lambda_{\\rho_2}\\right\\}_j\\right)\n\\left[\\left(\\left\\{\\mathbf{v}_{\\rho_1}\\right\\}_i \\otimes \\left\\{\\mathbf{v}_{\\rho_2}\\right\\}_j\\right)^T\\mathbf z\\right]^2\n$$\n:::\n\n## Calculating the copula density\n\n::: {style=\"font-size:70%\"}\nLet $\\mathbf v = \\left\\{\\mathbf{v}_{\\rho_1}\\right\\}_i \\otimes \\left\\{\\mathbf{v}_{\\rho_2}\\right\\}_j$ and $\\lambda = \\left(\\left\\{\\lambda_{\\rho_1}\\right\\}_i + \\left\\{\\lambda_{\\rho_2}\\right\\}_j\\right)^{\\nu + 1}$. Normalise $\\mathbf v$ and $\\lambda$ with\n\n$$\n\\begin{gathered}\n\\widetilde{\\mathbf{v}} = \\frac{\\sigma \\odot \\mathbf{v}}{\\vert\\vert \\sigma \\odot\\mathbf{v}\\vert\\vert_2}, \\qquad\n\\widetilde{\\lambda} = \\vert\\vert \\sigma \\odot\\mathbf{v}\\vert\\vert_2^2 \\cdot \\lambda\n\\end{gathered}\n$$\n\nThen $\\widetilde{\\mathbf{v}}$ and $\\widetilde{\\lambda}$ are an eigenvector/value pair of the scaled precision matrix $\\mathbf{\\widetilde{Q}}$. Iterate over $i$ and $j$ to calculate\n\n$$\n\\log c(\\mathbf{u} \\vert \\mathbf{\\widetilde{Q}}) = \\frac{1}{2}\\log|\\mathbf{\\widetilde Q}| - \\frac{1}{2}\\mathbf{z}^T\\mathbf{\\widetilde Q}\\mathbf{z} + \\frac{1}{2}\\mathbf{z}^T\\mathbf{z}\n$$\n:::\n\n## Folded Circulant Approximation\n\n::: {style=\"font-size:40%\"}\n::: columns\n::: {.column width=\"40%\"}\n### AR(1) precision\n\nThe exact form of $Q_{\\rho}$, the precision matrix of a one-dimensional AR(1) process with correlation $\\rho$\n:::\n\n::: {.column width=\"60%\"}\n$$\n\\mathbf{Q}_\\rho = \\frac{1}{1-\\rho^2}\n\\begin{bmatrix}\n1 & -\\rho & 0 & \\cdots & 0 \\\\\n-\\rho & 1+\\rho^2 & -\\rho & \\cdots & 0 \\\\\n0 & -\\rho & 1+\\rho^2 & \\cdots & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\ddots & \\vdots \\\\\n0 & 0 & 0 & \\cdots & 1\n\\end{bmatrix}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n::: columns\n::: {.column width=\"40%\"}\n### Circulant Approximation\n\nThis approximation treats the first and last observations as neighbors, effectively wrapping the data around a circle. Very fast computation using FFT [@rue2005]\n:::\n\n::: {.column width=\"60%\"}\n$$\n\\mathbf{Q}_\\rho^{(circ)} = \\frac{1}{1-\\rho^2}\n\\begin{bmatrix}\n1+\\rho^2 & -\\rho & 0 & \\cdots & 0 & -\\rho \\\\\n-\\rho & 1+\\rho^2 & -\\rho & \\cdots & 0 & 0 \\\\\n0 & -\\rho & 1+\\rho^2 & \\cdots & 0 & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\ddots & \\vdots & \\vdots \\\\\n-\\rho & 0 & 0 & \\cdots & -\\rho & 1+\\rho^2\n\\end{bmatrix}\n$$\n:::\n:::\n\n------------------------------------------------------------------------\n\n::: columns\n::: {.column width=\"40%\"}\n### Folded Circulant Approximation [@kent2022; @mondal2018]\n\nWe double the data by reflecting it, giving us the data $x_1,  \\dots, x_n, x_n, \\dots, x_1$. We then model this doubled data with a $2n \\times 2n$ circulant matrix. Get fast computation like in circulant case, but better boundary conditions. Quadratic form written out as an $n \\times n$ matrix takes the form on the right.\n:::\n\n::: {.column width=\"60%\"}\n$$\n\\mathbf{Q}_\\rho^{(fold)} = \\frac{1}{1-\\rho^2}\n\\begin{bmatrix}\n1-\\rho+\\rho^2 & -\\rho & 0 & \\cdots & 0 & 0 \\\\\n-\\rho & 1+\\rho^2 & -\\rho & \\cdots & 0 & 0 \\\\\n0 & -\\rho & 1+\\rho^2 & \\cdots & 0 & 0 \\\\\n\\vdots & \\vdots & \\vdots & \\ddots & \\vdots & \\vdots \\\\\n0 & 0 & 0 & \\cdots & -\\rho & 1-\\rho+\\rho^2\n\\end{bmatrix}\n$$\n:::\n:::\n:::\n\n## Exact Stan Model {style=\"font-size:60%\"}\n\n\n\n\n::: {.cell output.var='matern_copula'}\n\n```{.stan .cell-code}\nreal matern_copula_exact_lpdf(matrix Z, int dim1, real rho1, int dim2, real rho2, int nu) {\n  int n_obs = cols(Z);\n  int D = dim1 * dim2;\n  tuple(matrix[dim1, dim1], vector[dim1]) E1 = ar1_precision_eigen(dim1, rho1);\n  tuple(matrix[dim2, dim2], vector[dim2]) E2 = ar1_precision_eigen(dim2, rho2);\n\n  real log_det = 0;\n  real quadform_sum = 0;\n\n  vector[D] marginal_sds = marginal_sd(E1, E2, nu);\n\n  for (i in 1:dim1) {\n    for (j in 1:dim2) {\n      vector[D] v = kronecker(E1.1[, i], E2.1[, j]);\n      v = v .* marginal_sds;  \n      real norm_v = sqrt(sum(square(v)));\n      v /= norm_v;  \n      \n      real lambda = pow(E1.2[i] + E2.2[j], nu + 1) * square(norm_v);\n      log_det += log(lambda);\n      \n      row_vector[n_obs] q = v' * Z;  \n      quadform_sum += dot_self(q) * lambda;\n    }\n  }\n\n  real z_squared = sum(columns_dot_self(Z));\n\n  return -0.5 * (quadform_sum - n_obs * log_det - z_squared);\n}\n```\n:::\n\n\n\n\n## PSIS-LOO-CV {style=\"font-size:60%\"}\n\n::: {.columns}\n::: {.column width=\"50%\"}\n![](images/burkner.png)\n\n![](images/burkner2.png)\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell output.var='psisloo_exact'}\n\n```{.stan .cell-code}\nvector matern_cond_loglik(vector y, int dim1, real rho1, int dim2, real rho2, int nu) {\n  int D = dim1 * dim2;\n  tuple(matrix[dim1, dim1], vector[dim1]) E1 = ar1_precision_eigen(dim1, rho1);\n  tuple(matrix[dim2, dim2], vector[dim2]) E2 = ar1_precision_eigen(dim2, rho2);\n\n  vector[D] marginal_sds = marginal_sd(E1, E2, nu);\n  vector[D] g = rep_vector(0, D);\n  vector[D] tau_tilde = rep_vector(0, D);\n\n  for (i in 1:dim1) {\n    for (j in 1:dim2) {\n      vector[D] v = kronecker(E1.1[, i], E2.1[, j]);\n      v = v .* marginal_sds;\n      real norm_v = sqrt(sum(square(v)));\n      v /= norm_v;\n\n      real lambda = pow(E1.2[i] + E2.2[j], nu + 1) * square(norm_v);\n      \n      g += v * lambda * v' * y;\n      tau_tilde += square(v) * lambda;\n  }\n}\n```\n:::\n\n\n\n:::\n:::\n\n## Approximation {style=\"font-size:50%\"}\n\n\n\n\n::: {.cell output.var='fold_data'}\n\n```{.stan .cell-code}\nvector fold_data(vector x, int n1, int n2) {\n  vector[4 * n1 * n2] folded;\n  for (i in 1:n1) {\n    for (j in 1:n2) {\n      int idx = (i - 1) * n2 + j;\n      folded[(i - 1) * 2 * n2 + j] = x[idx];\n      folded[(i - 1) * 2 * n2 + (2 * n2 - j + 1)] = x[idx];\n      folded[(2 * n1 - i) * 2 * n2 + j] = x[idx];\n      folded[(2 * n1 - i) * 2 * n2 + (2 * n2 - j + 1)] = x[idx];\n    }\n  }\n  return folded;\n}\n```\n:::\n\n::: {.cell output.var='base_matrix'}\n\n```{.stan .cell-code}\ncomplex_matrix create_base_matrix_and_rescale_eigenvalues(int dim1, int dim2, real rho1, real rho2, int nu) {\n  \n  matrix[dim2, dim1] c = make_base_matrix(dim1, dim2, rho1, rho2);\n\n  // Compute the eigenvalues and marginal standard deviation\n  complex_matrix[dim2, dim1] eigs = pow(fft2(c), (nu + 1.0));\n  complex_matrix[dim2, dim1] inv_eigs = pow(eigs, -1);\n  real mvar = get_real(inv_fft2(inv_eigs)[1, 1]);\n  eigs *= mvar;\n  \n  return eigs;\n}\n```\n:::\n\n::: {.cell output.var='folded_copula'}\n\n```{.stan .cell-code}\nreal matern_folded_copula_lpdf(matrix Z, int dim1, int dim2, real rho1, real rho2, int nu) {\n  int n_obs = cols(Z);\n  complex_matrix[2 * dim2, 2 * dim1] eigs = create_base_matrix_and_rescale_eigenvalues(2 * dim1, 2 * dim2, rho1, rho2, nu);\n  real quad_forms = 0;\n  real log_det = sum(log(get_real(eigs)));\n  for (i in 1:n_obs) {\n    vector[4 * dim1 * dim2] Z_fold = fold_data(Z[, i], dim1, dim2);\n    vector[4 * dim1 * dim2] Qz = matvec_prod(eigs, Z_fold);\n    quad_forms += dot_product(Z_fold, Qz) - dot_self(Z_fold);\n  } \n  return - 0.5 * (quad_forms - n_obs * log_det);\n}\n```\n:::\n\n\n\n\n## Data Generation {data-name=\"Results\"}\n\n::: {.columns style=\"font-size:60%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntictoc::tic()\nX <- rmatern_copula_folded_full(n = 100, dim1 = 400, dim2 = 180, rho1 = 0.8, rho2 = 0.9, nu = 2)\ntictoc::toc()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1.232 sec elapsed\n```\n\n\n:::\n:::\n\n\n\n\n::: {.column width=\"50%;text-align:center\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_matern(X[, 1], 400, 180)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-21-1.png){width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_matern(X[, 2], 400, 180)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-22-1.png){width=80%}\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\napply(X, 1, var) |> hist()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-23-1.png){width=80%}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\napply(X, 1, mean) |> hist()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-24-1.png){width=80%}\n:::\n:::\n\n\n\n:::\n:::\n\n## Maximum Likelihood\n\n::: {.columns style=\"font-size:50%\"}\n::: {.column width=\"60%\"}\n**Setup**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(stdmatern)\ndim1 <- 50; dim2 <- 50\nrho1 <- 0.9; rho2 <- 0.5\nnu <- 1\nn_obs <- 5\nZ <- rmatern_copula_eigen(n_obs, dim1, dim2, rho1, rho2, nu)\nU <- pnorm(Z)\nY <- qgev(U, loc = 6, scale = 2, shape = 0.1)\n```\n:::\n\n\n\n\n**Log-likelihood**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_lik <- function(par, Y) {\n  mu <- exp(par[1])\n  sigma <- exp(par[2] + par[1])\n  xi <- exp(par[3])\n  rho1 <- plogis(par[4])\n  rho2 <- plogis(par[5])\n  u <- evd::pgev(Y, loc = mu, scale = sigma, shape = xi)\n  z <- qnorm(u)\n  ll_marg <- sum(evd::dgev(Y, loc = mu, scale = sigma, shape = xi, log = TRUE))\n  ll_copula <- sum(dmatern_copula_eigen(z, dim1, dim2, rho1, rho2, nu))\n  ll_copula + ll_marg\n}\n```\n:::\n\n\n\n\n**Optimize**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntictoc::tic()\nres <- optim(\n  par = c(0, 0, 0, 0, 0),\n  log_lik,\n  control = list(fnscale = -1),\n  Y = Y,\n  hessian = TRUE,\n  method = \"L-BFGS-B\"\n)\ntictoc::toc()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2.349 sec elapsed\n```\n\n\n:::\n:::\n\n\n\n:::\n\n::: {.column width=\"40%\"}\n<br> <br>\n\n**Results**\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nse <- sqrt(diag(solve(-res$hessian)))\nci <- res$par + c(-1.96, 1.96) * se\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xwagawglaw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xwagawglaw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xwagawglaw thead, #xwagawglaw tbody, #xwagawglaw tfoot, #xwagawglaw tr, #xwagawglaw td, #xwagawglaw th {\n  border-style: none;\n}\n\n#xwagawglaw p {\n  margin: 0;\n  padding: 0;\n}\n\n#xwagawglaw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xwagawglaw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xwagawglaw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xwagawglaw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xwagawglaw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xwagawglaw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xwagawglaw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xwagawglaw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xwagawglaw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xwagawglaw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xwagawglaw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xwagawglaw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xwagawglaw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xwagawglaw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xwagawglaw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xwagawglaw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xwagawglaw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xwagawglaw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xwagawglaw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xwagawglaw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xwagawglaw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xwagawglaw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xwagawglaw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xwagawglaw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xwagawglaw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xwagawglaw .gt_left {\n  text-align: left;\n}\n\n#xwagawglaw .gt_center {\n  text-align: center;\n}\n\n#xwagawglaw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xwagawglaw .gt_font_normal {\n  font-weight: normal;\n}\n\n#xwagawglaw .gt_font_bold {\n  font-weight: bold;\n}\n\n#xwagawglaw .gt_font_italic {\n  font-style: italic;\n}\n\n#xwagawglaw .gt_super {\n  font-size: 65%;\n}\n\n#xwagawglaw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xwagawglaw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xwagawglaw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xwagawglaw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xwagawglaw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xwagawglaw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xwagawglaw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#xwagawglaw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#xwagawglaw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Estimate\">Estimate</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"95% CI\">\n        <span class=\"gt_column_spanner\">95% CI</span>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Lower\">Lower</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Upper\">Upper</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"par\" class=\"gt_row gt_left\"><div data-qmd-base64=\"PGI+Jm11OzxzdWI+PC9zdWI+PC9iPg==\"><div class='gt_from_md'><p><b>μ<sub></sub></b></p>\n</div></div></td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">6.164</td>\n<td headers=\"lower\" class=\"gt_row gt_right\">5.925</td>\n<td headers=\"upper\" class=\"gt_row gt_right\">6.412</td></tr>\n    <tr><td headers=\"par\" class=\"gt_row gt_left gt_striped\"><div data-qmd-base64=\"PGI+JnNpZ21hOzxzdWI+PC9zdWI+PC9iPg==\"><div class='gt_from_md'><p><b>σ<sub></sub></b></p>\n</div></div></td>\n<td headers=\"estimate\" class=\"gt_row gt_right gt_striped\">2.126</td>\n<td headers=\"lower\" class=\"gt_row gt_right gt_striped\">1.952</td>\n<td headers=\"upper\" class=\"gt_row gt_right gt_striped\">2.316</td></tr>\n    <tr><td headers=\"par\" class=\"gt_row gt_left\"><div data-qmd-base64=\"PGI+JnhpOzxzdWI+PC9zdWI+PC9iPg==\"><div class='gt_from_md'><p><b>ξ<sub></sub></b></p>\n</div></div></td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">0.123</td>\n<td headers=\"lower\" class=\"gt_row gt_right\">0.103</td>\n<td headers=\"upper\" class=\"gt_row gt_right\">0.148</td></tr>\n    <tr><td headers=\"par\" class=\"gt_row gt_left gt_striped\"><div data-qmd-base64=\"PGI+JnJobzs8c3ViPjE8L3N1Yj48L2I+\"><div class='gt_from_md'><p><b>ρ<sub>1</sub></b></p>\n</div></div></td>\n<td headers=\"estimate\" class=\"gt_row gt_right gt_striped\">0.901</td>\n<td headers=\"lower\" class=\"gt_row gt_right gt_striped\">0.895</td>\n<td headers=\"upper\" class=\"gt_row gt_right gt_striped\">0.906</td></tr>\n    <tr><td headers=\"par\" class=\"gt_row gt_left\"><div data-qmd-base64=\"PGI+JnJobzs8c3ViPjI8L3N1Yj48L2I+\"><div class='gt_from_md'><p><b>ρ<sub>2</sub></b></p>\n</div></div></td>\n<td headers=\"estimate\" class=\"gt_row gt_right\">0.506</td>\n<td headers=\"lower\" class=\"gt_row gt_right\">0.482</td>\n<td headers=\"upper\" class=\"gt_row gt_right\">0.530</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n:::\n:::\n\n## Benchmark: Density Computations \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"cjkmkijpxo\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#cjkmkijpxo table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#cjkmkijpxo thead, #cjkmkijpxo tbody, #cjkmkijpxo tfoot, #cjkmkijpxo tr, #cjkmkijpxo td, #cjkmkijpxo th {\n  border-style: none;\n}\n\n#cjkmkijpxo p {\n  margin: 0;\n  padding: 0;\n}\n\n#cjkmkijpxo .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#cjkmkijpxo .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#cjkmkijpxo .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#cjkmkijpxo .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#cjkmkijpxo .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#cjkmkijpxo .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#cjkmkijpxo .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#cjkmkijpxo .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#cjkmkijpxo .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#cjkmkijpxo .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#cjkmkijpxo .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cjkmkijpxo .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#cjkmkijpxo .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#cjkmkijpxo .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#cjkmkijpxo .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cjkmkijpxo .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#cjkmkijpxo .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#cjkmkijpxo .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#cjkmkijpxo .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cjkmkijpxo .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#cjkmkijpxo .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cjkmkijpxo .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#cjkmkijpxo .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cjkmkijpxo .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cjkmkijpxo .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cjkmkijpxo .gt_left {\n  text-align: left;\n}\n\n#cjkmkijpxo .gt_center {\n  text-align: center;\n}\n\n#cjkmkijpxo .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#cjkmkijpxo .gt_font_normal {\n  font-weight: normal;\n}\n\n#cjkmkijpxo .gt_font_bold {\n  font-weight: bold;\n}\n\n#cjkmkijpxo .gt_font_italic {\n  font-style: italic;\n}\n\n#cjkmkijpxo .gt_super {\n  font-size: 65%;\n}\n\n#cjkmkijpxo .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#cjkmkijpxo .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#cjkmkijpxo .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#cjkmkijpxo .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#cjkmkijpxo .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#cjkmkijpxo .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#cjkmkijpxo .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#cjkmkijpxo .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#cjkmkijpxo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <caption><div data-qmd-base64=\"QmVuY2htYXJraW5nIGhvdyBsb25nIGl0IHRha2VzIHRvIGV2YWx1YXRlIHRoZSBkZW5zaXR5IG9mIGEgTcOhdGVybigkXG51JCktbGlrZSBmaWVsZCB3aXRoIGNvcnJlbGF0aW9uIHBhcmFtZXRlciAkXHJobyQsIGVpdGhlciB1bnNjYWxlZCBvciBzY2FsZWQgdG8gaGF2ZSB1bml0IG1hcmdpbmFsIHZhcmlhbmNl\"><div class='gt_from_md'><p>Benchmarking how long it takes to evaluate the density of a Mátern($\\nu$)-like field with correlation parameter \\(\\rho\\), either unscaled or scaled to have unit marginal variance</p>\n</div></div></caption>\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id></th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" scope=\"colgroup\" id=\"Unscaled\">\n        <span class=\"gt_column_spanner\">Unscaled</span>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"5\" scope=\"colgroup\" id=\"Scaled\">\n        <span class=\"gt_column_spanner\">Scaled</span>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Grid\">Grid</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Cholesky\">Cholesky</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Eigen\">\n        <span class=\"gt_column_spanner\">Eigen</span>\n      </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Eigen\">Eigen</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Circulant\">\n        <span class=\"gt_column_spanner\">Circulant</span>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Folded\">\n        <span class=\"gt_column_spanner\">Folded</span>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Time\">Time</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Relative\">Relative</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Time\">Time</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Relative\">Relative</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Time\">Time</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Relative\">Relative</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">20x20</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">312.56µs</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">155.88µs</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">49.9%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">235.59µs</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">36.2µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">15.4%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">115.09µs</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">48.9%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">40x40</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">1.77ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">543.76µs</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">30.7%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">1.65ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">115.8µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">7.0%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">300.9µs</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">18.3%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">60x60</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">6.33ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">1.8ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">28.5%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">7.1ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">188.48µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">2.7%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">609.71µs</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">8.6%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">80x80</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">17.98ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">5.17ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">28.8%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">21.96ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">338.15µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">1.5%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">1.26ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">5.7%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">100x100</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">38.58ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">11.48ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">29.8%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">48.44ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">445.14µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">0.9%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">2.37ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">4.9%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">120x120</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">81.1ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">22.74ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">28.0%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">88.45ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">719.55µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">0.8%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">2.82ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">3.2%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">140x140</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">145.26ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">32.55ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">22.4%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">168.38ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">965.71µs</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">0.6%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">5.39ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">3.2%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">160x160</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">233.03ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">54.51ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">23.4%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">260.7ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">1.27ms</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">0.5%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">5.33ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">2.0%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">180x180</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">359.21ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">97.4ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">27.1%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">482.93ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">1.61ms</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">0.3%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">10.22ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">2.1%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">200x200</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">567.01ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">147.51ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">26.0%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">676.53ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">1.84ms</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">0.3%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">8.62ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">1.3%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left\">220x220</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left\">791.13ms</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left\">206.13ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right\">26.1%</td>\n<td headers=\"eig\" class=\"gt_row gt_left\">994.11ms</td>\n<td headers=\"circ\" class=\"gt_row gt_left\">2.59ms</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right\">0.3%</td>\n<td headers=\"fol\" class=\"gt_row gt_left\">13.55ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right\">1.4%</td></tr>\n    <tr><td headers=\"Grid\" class=\"gt_row gt_left gt_striped\">240x240</td>\n<td headers=\"Cholesky (Unscaled)\" class=\"gt_row gt_left gt_striped\">1.07s</td>\n<td headers=\"Eigen (Unscaled)\" class=\"gt_row gt_left gt_striped\">287ms</td>\n<td headers=\"sp_3\" class=\"gt_row gt_right gt_striped\">26.8%</td>\n<td headers=\"eig\" class=\"gt_row gt_left gt_striped\">1.34s</td>\n<td headers=\"circ\" class=\"gt_row gt_left gt_striped\">2.82ms</td>\n<td headers=\"sp_1\" class=\"gt_row gt_right gt_striped\">0.2%</td>\n<td headers=\"fol\" class=\"gt_row gt_left gt_striped\">14.77ms</td>\n<td headers=\"sp_2\" class=\"gt_row gt_right gt_striped\">1.1%</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"9\"> <div data-qmd-base64=\"U2VlIFtodHRwczovL2JnZ2ouaXMvbWF0ZXJuZWlnZW5wYXBlci9dKGh0dHBzOi8vYmdnai5pcy9tYXRlcm5laWdlbnBhcGVyLykgZm9yIGEgZGVzY3JpcHRpb24gb2YgYWxnb3JpdGhtcyBhbmQgW2h0dHBzOi8vZ2l0aHViLmNvbS9iZ2F1dGlqb25zc29uL3N0ZG1hdGVybl0oaHR0cHM6Ly9naXRodWIuY29tL2JnYXV0aWpvbnNzb24vc3RkbWF0ZXJuKSBmb3IgaW1wbGVtZW50YXRpb25z\"><div class='gt_from_md'><p>See <a href=\"https://bggj.is/materneigenpaper/\">https://bggj.is/materneigenpaper/</a> for a description of algorithms and <a href=\"https://github.com/bgautijonsson/stdmatern\">https://github.com/bgautijonsson/stdmatern</a> for implementations</p>\n</div></div></td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n## Approximating the Correlation Matrix\n\n![](images/cors.png)\n\n\n\n## Conclusion and Future Work {data-name=\"Conclusion\"}\n\n::: {.columns style=\"font-size:60%\"}\n::: {.column width=\"50%\"}\n### Key Results\n\n-   Developed Matérn-like Gaussian copula for large spatial fields\n-   Folded circulant approximation to the density\n-   Achieved fast density computations\n-   Viable for MCMC samplers\n:::\n\n::: {.column width=\"50%\"}\n### Future Work\n\n-   Implement t-copulas\n-   Apply to other environmental and climate datasets\n-   [Finish drafting paper](https://www.bggj.is/materneigenpaper)\n-   [R package](https://www.github.com/bgautijonsson/stdmatern)\n:::\n\n------------------------------------------------------------------------\n\n### PhD Committee\n\nMy thanks to my advisor and committee\n\n-   Birgir Hrafnkelsson (PI)\n-   Raphaël Huser\n-   Stefan Siegert\n:::\n\n# References\n\n::: {#refs style=\"font-size:55%\"}\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}